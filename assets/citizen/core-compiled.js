let TOAST=window.TOAST||{};TOAST={init:function(t){this.setOptions(t,$.toast.options),this.build()},setOptions:function(t,s){this.options=$.extend({},s,t)},build:function(){this.setup(),this.setPosition(),this.renderHTML(),this.animate()},setup:function(){let t=$(".toaster-wrapper");this.content=$(`<div class="toast-content">${this.options.content}</div>`),this.itemEl=$('<div class="toast"></div>'),t.length||(t=$('<div class="toaster-wrapper"></div>'),$("body").append(t)),this.options.stacking?t.find(`.toast.${this.options.hideClass}`).remove():t.find(".toast").remove(),this.itemEl.append(this.content),t.prepend(this.itemEl),this.wrapper=t},setPosition:function(){this.wrapper.removeClass().addClass(`toaster-wrapper ${this.options.position}`)},renderHTML:function(){window.setTimeout(()=>{this.itemEl.addClass(this.options.showClass)},1)},animate:function(){this.options.hideAfter&&window.setTimeout(()=>{this.itemEl.removeClass(this.options.showClass),this.itemEl.addClass(this.options.hideClass)},this.options.hideAfter)},reset:function(){this.wrapper.empty()}},$.toast=function(t){let s=Object.create(TOAST);return s.init(t),{reset:function(){s.reset()}}},$.toast.options={content:"",position:"bottom-right",hideClass:"toast-hide",showClass:"toast-show",hideAfter:1250,stacking:!1};

let CITIZEN=window.CITIZEN||{};void 0===window.jQuery&&(jQuery=$={}),(CITIZEN={fancyOptions:{loop:!0,buttons:["slideShow","fullScreen","thumbs","download","zoom","close"],transitionEffect:"slide",thumbs:{axis:"x"},lang:"zh",i18n:{zh:{CLOSE:"关闭",NEXT:"下一个",PREV:"上一个",ERROR:"内容加载失败。",PLAY_START:"播放幻灯片",PLAY_STOP:"暂停幻灯片",FULL_SCREEN:"全屏",THUMBS:"缩略图",DOWNLOAD:"下载",ZOOM:"缩放"}}},init:function(){$("#searchSubmit").click(function(t){t.preventDefault(),CITIZEN.submitSearch()}),this.reload(),this.onPjax()},reload:function(){try{"undefined"!=typeof ajaxComment&&ajaxComment.init()}catch(t){}this.fnPrismJS(),this.fnFancybox(),this.lazyLoader(),this.fnTocBot(),this.pawButtonInit()},fnFancybox:function(){$(".p-content figure.image").each(function(){let t=$(this).find("a[data-lightbox]");t.attr({"data-fancybox":"articleBody","data-caption":$(this).find("figcaption").text()})}),$.fancybox&&$("[data-lightbox]").fancybox(this.fancyOptions)},fnPrismJS:function(){if("undefined"!=typeof Prism){let t=document.getElementsByTagName("pre");for(let e=0;e<t.length;e++)t[e].getElementsByTagName("code").length>0&&(t[e].className="line-numbers");Prism.highlightAll(0,null)}},fnTocBot:function(){$(".p-toc").length&&tocbot.init({tocSelector:".toc-target",contentSelector:".p-content",headingSelector:"h2",ignoreSelector:".js-toc-ignore",activeLinkClass:"is-active",hasInnerContainers:!0,scrollSmooth:!0,scrollSmoothDuration:40,headingsOffset:20,scrollSmoothOffset:-20,includeTitleTags:!0})},actionLike:function(){if(this.likeStatus||!this.likeButton.hasClass("liked"))return;let t=CITIZEN.likeButton.attr("data-cid");$.ajax({type:"post",url:this.likeButton.attr("data-url"),data:"like="+this.likeButton.attr("data-cid"),async:!0,timeout:3e4,cache:!1,success:function(e){let n=JSON.parse(localStorage.getItem("like_record"));n||(n=[]),n.push(t),localStorage.setItem("like_record",JSON.stringify(n))}})},pawButtonInit:function(){CITIZEN.likeButton=$("#actionLike");let t=JSON.parse(localStorage.getItem("like_record"));if(CITIZEN.likeStatus=this.likeButton&&-1!==$.inArray(this.likeButton.attr("data-cid"),t),CITIZEN.likeStatus){this.likeButton.addClass("animation liked confetti noEffect");return}let e=["#7d32f5","#f6e434","#63fdf1","#e672da","#295dfe","#6e57ff"],n=(t,e)=>Math.floor(Math.random()*(e-t+1)+t),i=t=>{let i=document.createElement("i");i.style.setProperty("--x",n(-260,260)+"px"),i.style.setProperty("--y",n(-160,160)+"px"),i.style.setProperty("--r",n(0,360)+"deg"),i.style.setProperty("--s",n(.6,1)),i.style.setProperty("--b",e[n(0,5)]),t.appendChild(i)};document.querySelectorAll("#actionLike").forEach(t=>{t.addEventListener("click",e=>{let n=t.children[1].textContent;if(t.classList.contains("animation"))t.classList.remove("animation","liked","confetti"),t.children[1].textContent=parseInt(n)-1;else{t.classList.add("animation");for(let a=0;a<60;a++)i(t);setTimeout(()=>{t.classList.add("confetti"),setTimeout(()=>{t.classList.add("liked"),t.children[1].textContent=parseInt(n)+1},400),setTimeout(()=>{t.querySelectorAll("i").forEach(t=>t.remove())},600)},260)}e.preventDefault()})})},lazyLoader:function(){$(".lazy").Lazy({effect:"fadeIn",visibleOnly:!0,effectTime:300,onError:function(t){console.error("加载 "+t.data("src")+" 时发生了错误。")},afterLoad:function(t){$(t).addClass("lazy-loaded")}})},submitSearch:function(){let t=$("#searchInput");if(""===t.val())$.toast({content:"请输入关键词。"});else{let e=window.location.protocol+"//"+window.location.host+"/index.php/search/"+t.val()+"/";$.pjax({url:e,container:"#main",fragment:"#main",timeout:8e3}).done(function(){$("article .p-snippet").each(function(){$(this).html($(this).text().replace(RegExp(t.val(),"g"),'<span class="p-search--word">$&</span>'))})}),$("body").click()}},onPjax:function(){$(document).pjax('a:not(a[target="_blank"], a[no-pjax], .cancel-comment-reply a, .comment-reply a)',{container:"#main",fragment:"#main",timeout:8e3}).on("pjax:click",function(){CITIZEN.actionLike()}).on("pjax:send",function(){$(".bar-loader").fadeIn(100),$(window).off("scroll"),$(".p-toc").length&&tocbot.destroy()}).on("pjax:complete",function(){CITIZEN.reload(),$(".bar-loader").fadeOut(300)})}}).init();

!function(s,k,e){"use strict";let n=s("html");s("#theme-toggle").click(function s(k){"off"===k?n.addClass("skin-dark"):"on"===k?n.removeClass("skin-dark"):n.toggleClass("skin-dark"),n.hasClass("skin-dark")?(localStorage.setItem("skinDark","yes"),e.cookie="skinDark=y"):(localStorage.setItem("skinDark","no"),e.cookie="skinDark=n")})}(window.jQuery,window,document);

!function(n,t,e){"use strict";let o=null,l=!1,s=!1,i=!1,r=t.pageYOffset||e.documentElement.scrollTop,u=null,c=null,a,f=null,$=e.querySelector(".progress-wrap path"),d=$?$.getTotalLength():0;function p(n){if(l)return;let i=t.pageYOffset||e.documentElement.scrollTop,f=r;if(r=i,i>f)"down"!==u&&(u="down",c=f);else{if(!(i<f))return;"up"!==u&&(u="up",c=f)}if(s){if("up"!==u||r<100){a&&(a.cancel(),a=null);return}if(c-i<30)return}a||(a=function n(e,o){o||(o=0);let l=t.requestAnimationFrame||function(n){return t.setTimeout(n,1e3/60)},s=Date.now(),i={};function r(){Date.now()-s>=o?e():i.id=l(r)}return i.id=l(r),i.cancel=function(){(t.cancelAnimationFrame||t.clearTimeout)(this.id)},i}(function(){a=null,r<10?h():(m(),y(),o=setTimeout(function(){h()},3e3))},50))}function m(){i||(f.removeClass("hidden"),f.addClass("active-progress"),i=!0)}function h(){i&&(f.addClass("hidden"),f.removeClass("active-progress"),i=!1)}function g(){let o=n(t).scrollTop(),l=n(e).height()-n(t).height();$.style.strokeDashoffset=d-o*d/l}function y(){clearTimeout(o)}f&&f.length||!(f=n(".js-scrollButtons")).length||("up"===f.data("trigger-type")&&(s=!0),f.on({"mouseenter focus":function n(){r>0&&(y(),m())},"mouseleave blur":function n(){y()},click:function n(t){l=!0,setTimeout(function(){l=!1},500),h(),jQuery("html, body").animate({scrollTop:0},80)}}),d&&($.style.transition=$.style.WebkitTransition="none",$.style.strokeDasharray=d+" "+d,$.style.strokeDashoffset=d,$.getBoundingClientRect(),$.style.transition=$.style.WebkitTransition="stroke-dashoffset 10ms linear",g(),n(t).scroll(g)),n(t).scroll(p)),n(e).on("pjax:click",function(){h()}).on("pjax:complete",function(){n(t).scroll(g),n(t).scroll(p)})}(window.jQuery,window,document);

!function(e,t){"use strict";function n(e,t){if(t){t.setAttribute("aria-expanded",e.checked.toString());return}e.setAttribute("aria-expanded",e.checked.toString())}function i(e,n){e.checked=n;let i;if("function"==typeof Event)i=new Event("input",{bubbles:!0,composed:!0});else{if(!(i=t.createEvent("CustomEvent")))return;i.initCustomEvent("input",!0,!1,!1)}e.dispatchEvent(i)}function c(e,n,i,c){let r=c.target instanceof Node&&(e.contains(c.target)||n.contains(c.target)||i.contains(c.target));if(e.checked&&!r){e.checked=!1;let o;if("function"==typeof Event)o=new Event("input",{bubbles:!0,composed:!0});else{let u=t.createEvent("CustomEvent");if(!u)return;u.initCustomEvent("input",!0,!1,!1)}e.dispatchEvent(o)}}!function r(){let o=t.querySelectorAll(".p-menu-checkbox-container");o.forEach(t=>{let r=t.querySelector(".p-menu-checkbox"),o=t.querySelector(".p-menu-checkbox-button"),u=t.querySelector(".p-menu-checkbox-target");r&&o&&u&&function e(t,r,o,u){let f=[function e(t,i){let c=n.bind(void 0,t,void 0);return t.addEventListener("input",c),function(){t.removeEventListener("input",c)}}(r),function e(t,n){function c(e){e.preventDefault(),i(t,!t.checked)}return n.addEventListener("click",c,!0),function(){n.removeEventListener("click",c,!0)}}(r,o),function e(t){function n(e){"Enter"===e.key&&i(t,!t.checked)}return t.addEventListener("keyup",n),function(){t.removeEventListener("keyup",n)}}(r),function e(t,n,i,r){let o=c.bind(void 0,n,i,r);return t.addEventListener("click",o,!0),function(){t.removeEventListener("click",o,!0)}}(t,r,o,u),function e(t,n,i,r){let o=c.bind(void 0,n,i,r);return t.addEventListener("focusin",o,!0),function(){t.removeEventListener("focusin",o,!0)}}(t,r,o,u),function e(t,n){function c(e){("A"===e.target.nodeName||"A"===e.target.parentNode.nodeName)&&i(t,!1)}return n.addEventListener("click",c),function(){n.removeEventListener("click",c)}}(r,u),function e(t,n){let c=e=>{"Escape"===e.key&&i(n,!1)};return t.addEventListener("keyup",c,!0),function(){t.removeEventListener("keyup",c)}}(t,r)];return function(){f.forEach(function(e){e()})}}(e,r,o,u)})}()}(window,document);

let PLAYER=window.PLAYER||{};const PLAYER_API="/play.php/?type=playlist&id=",PLAY_TEXT=$("#playPause span");(PLAYER={musicArray:[],musicCurrent:null,mainContainer:$(".p-player"),albumContainer:$(".p-player--album"),infoContainer:$(".p-player--info"),canvasContainer:document.getElementById("playerVisualizer"),sound:null,pointer:0,random:!1,mute:!1,loop:!1,bound:!1,init:function(t=""){if("undefined"==typeof Howl){console.log("由于未引入 Howler，播放器现已中止加载。");return}if(0===this.mainContainer.length){console.error("找不到播放器容器。");return}let n=""===t?this.mainContainer.data("playlist"):t;n?this.processPlaylist(n):console.warn("未声明歌单 ID。")},playerInit:function(t){this.musicArray=t,this.musicCurrent=t[0],this.playerUI(),this.bindFunctions({playPause:"actionPlay",songNext:"playNext",songPrevious:"playPrevious",songShuffle:"actionShuffle",songRepeat:"actionLoop"})},processPlaylist:function(t){fetch(PLAYER_API+t).then(t=>t.json()).then(t=>{""!==t[0].name?this.playerInit(t):console.error("歌单中不存在音乐，请检查所提供的歌单。")})},play:function(t){this.musicCurrent=this.musicArray[t],this.musicCurrent&&(this.sound&&this.sound.stop(),this.sound=new Howl({src:this.musicCurrent.url,format:["mp3"],preload:!0,autoplay:!1,loop:this.loop,onload:function(){$("#playPause").removeClass("is-loading")},onplay:function(){PLAY_TEXT.html("pause")},onpause:function(){PLAY_TEXT.html("play_arrow")},onstop:function(){PLAY_TEXT.html("play_arrow")},onend:function(){PLAY_TEXT.html("play_arrow"),PLAYER.playNext(1,!0),setTimeout(function(){PLAYER.onNextUI()},1500)}}),this.playerUI(),this.visualizerUI(),"loading"===this.sound.state()&&$("#playPause").addClass("is-loading"),this.sound.play())},playerUI:function(){$(".p-player--info h1").text(this.musicCurrent.name),$(".p-player--info h2").text(this.musicCurrent.artist),$(".p-player--album img").attr("src",this.musicCurrent.pic)},onNextUI:function(){$(".player-indicator img").attr("src",this.musicCurrent.pic),$(".player-indicator").fadeIn("fast",function(){$(this).delay(1e3).fadeOut("fast")})},visualizerUI:function(){if(!this.canvasContainer)return;let t=Howler.ctx,n=this.canvasContainer.getContext("2d"),i=null;i=t.createAnalyser();let a=this.sound._sounds[0]._node;a.connect(i),i.fftSize=128;let s=i.frequencyBinCount,e=new Uint8Array(s),o=this.canvasContainer.width/s,r=0,l=({bufferLength:t,dataArray:i,barWidth:a})=>{let s;for(let e=0;e<t;e++){s=.75*i[e+10];let o=e*s/10,l=5*e,u=s/4-16;n.fillStyle=`rgb(${o}, ${l}, ${u})`,n.fillRect(r,PLAYER.canvasContainer.height-s,a,s),r+=a}};!function t(){r=0,n.clearRect(0,0,PLAYER.canvasContainer.width,PLAYER.canvasContainer.height),i.getByteFrequencyData(e),l({bufferLength:s,dataArray:e,barWidth:o}),requestAnimationFrame(t)}()},playNext:function(t=1,n=!1){if(n&&this.loop)return!0;this.random?this.pointer=Math.floor(Math.random()*(this.musicArray.length-1)):(this.pointer+=t,this.pointer<0?this.pointer=this.musicArray.length-1:this.pointer===this.musicArray.length&&(this.pointer=0)),this.play(this.pointer)},playPrevious:function(){this.playNext(-1)},actionPlay:function(){this.sound?this.sound.playing()?this.sound.pause():this.sound.play():this.play(this.pointer)},actionShuffle:function(){this.loop=!1,this.random=!this.random,$("#songShuffle").toggleClass("is-active"),$("#songRepeat").removeClass("is-active")},actionLoop:function(){this.random=!1,this.loop=!this.loop,$("#songRepeat").toggleClass("is-active"),$("#songShuffle").removeClass("is-active")},bindFunctions:function(t){this.bound||($.each(t,function(t,n){$("#"+t).click(function(){"function"==typeof PLAYER[n]&&PLAYER[n]()})}),this.bound=!0)}}).init();