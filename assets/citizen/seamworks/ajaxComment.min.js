let replyTo="",ajaxComment=window.ajaxComment||{};ajaxComment={formMail:null,formText:null,formAuthor:null,init:function(){this.formMail=$('#comment-form [name="mail"]'),this.formText=$('#comment-form [name="text"]'),this.formAuthor=$('#comment-form [name="author"]'),$("#commentSubmit").click(function(t){let e;return ajaxComment.formText.length&&!(ajaxComment.formText.val().length>0)?($.toast({content:"请填写评论内容。"}),!1):ajaxComment.formMail.attr("required")&&(!ajaxComment.formAuthor.val().length>0||!ajaxComment.formMail.val().length>0)?($.toast({content:"昵称和邮箱不能为空。"}),!1):ajaxComment.formAuthor.length&&!ajaxComment.formMail.attr("required")&&!ajaxComment.formAuthor.val().length>0?($.toast({content:"昵称不能为空。"}),!1):void(ajaxComment.preSubmit(),e=login?{text:ajaxComment.formText.val()}:{author:ajaxComment.formAuthor.val(),mail:ajaxComment.formMail.val(),text:ajaxComment.formText.val()},document.getElementById("comment-parent")&&(e.parent=document.getElementById("comment-parent").value),document.getElementById("comment-notify")&&(e.notify=document.getElementById("comment-notify").checked?1:0),$.ajax({type:"POST",url:$("#comment-form").attr("action"),data:e,error:function(t,e,m){403===t.status?$.toast({content:"评论发送过于频繁，请稍后再试。"}):$.toast({content:"评论发送失败，请尝试刷新。"}),ajaxComment.postSubmit(!1)},success:function(t){let e;if(!$("#comments",t).length)return t=$("<body></body>").prepend(t),e=$("pre>code>h1",t).length?$("pre > code > h1",t).text():"error"===$("title").eq(0).text().trim().toLowerCase()?$(".container",t).eq(0).text():"评论提交失败",$.toast({content:e}),ajaxComment.postSubmit(!1),!1;let m=$(document.createElement("body")).append(t);if(!m.html())return $.toast({content:"获取评论 ID 时发生了错误，请刷新重试。"}),!1;newCommentId=m.html().match(/id=\"?comment-\d+/g).join().match(/\d+/g).sort(function(t,e){return t-e}).pop();let o,n;""===replyTo?$(".comment-list").length?$(".prev").length?$(".comments-pagenav li a").eq(1).click():(o=$("#comment-"+newCommentId,t).addClass("fadeIn"),$(".comment-list").first().prepend(o)):$(".respond").after($(".comment-list",t)):(o=$("#comment-"+newCommentId,t).addClass("fadeIn"),(n=$("#"+replyTo)).hasClass("comment-parent")?n.find(".comment-children").length?($("#"+replyTo+" .comment-children .comment-list").first().prepend(o),TypechoComment.cancelReply()):(n.append('<div class="comment-children"><ol class="comment-list"></ol></div>'),$("#"+replyTo+" .comment-children .comment-list").first().prepend(o),TypechoComment.cancelReply()):(n.after(o),TypechoComment.cancelReply())),ajaxComment.postSubmit(!0),$.toast({content:"评论成功。"})}}))})},preSubmit:function(){$("#comment-form .submit").html("处理中"),$("#comment-form input,#comment-form textarea,#comment-form .submit").attr("disabled",!0).css("cursor","not-allowed"),$("#comment-form").animate({opacity:.5},300)},postSubmit:function(t){$("#comment-form .submit").html("提交评论"),$("#comment-form input,#comment-form textarea,#comment-form .submit").attr("disabled",!1).css("cursor","pointer"),$("#comment-form").animate({opacity:1},100),t&&($("#textarea").val(""),replyTo="")}};